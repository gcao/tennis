<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<html class='no-js'>
  <head>
    <meta charset='utf-8' />
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible' />
    <title>Set your site title in /helpers/site_helpers.rb</title>
    <meta content='Set your site description in /helpers/site_helpers.rb' name='description' />
    <meta content='width=device-width' name='viewport' />
    <script src="/javascripts/vendor/modernizr-2.6.1.min.js" type="text/javascript"></script>
    <link href="/stylesheets/site.css" media="screen" rel="stylesheet" type="text/css" />
    <script type='text/javascript'>
      //<![CDATA[
        window.jQuery || document.write('<' + 'script src="javascripts/vendor/jquery-1.8.0.min.js"><' + '/script>')
      //]]>
    </script>
    <script src="/javascripts/site.js" type="text/javascript"></script>
  </head>
  <body>
    <!--[if lt IE 7]> <p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p> <![endif]-->
    <header>
      <div class='wrap'>
        <h2>
          <a href='/index.html'>
            <img class='logo' src='/images/site-logo.gif' />
          </a>
        </h2>
        <div id='menu'>
          <ul>
            <li class='rankings'>
              <span>
                <a href='/rankings.html'>Rankings</a>
              </span>
            </li>
            <li class='rank-history'>
              <span>
                <a href='/rank-history.html'>Rank History</a>
              </span>
            </li>
            <li class='tournaments'>
              <span>
                <a href='/tournaments.html'>Tournaments</a>
              </span>
            </li>
            <li class='support'>
              <span>
                <a href='/support.html'>Support</a>
              </span>
            </li>
          </ul>
        </div>
      </div>
    </header>
    <div class='main' role='main'>
      <div id='map'></div>
      <script src='http://maps.google.com/maps/api/js?sensor=true' type='text/javascript'></script>
      <script src="/data/tournaments.js" type="text/javascript"></script>
      <script type='text/javascript'>
        //<![CDATA[
          var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 3,
            center: new google.maps.LatLng(20, 0),
            mapTypeId: google.maps.MapTypeId.TERRAIN
          });
          var atp500Markers = [];
          var atp250Markers = [];
          $.each(tournaments.data, function(i, tournament){
            var icon = '';
            var zIndex = 1;
            var show = true;
            if (tournament.type === 'atp250') {
              icon = 'http://www.atpworldtour.com/~/media/810218DC73784BEEA6EF0978B2842A69.ashx?w=31&h=36';
              zIndex = 2;
              show = false;
            } else if (tournament.type === 'atp500') {
              icon = 'http://www.atpworldtour.com/~/media/1DB04CA8505648B7B511FA1E37F1E3BA.ashx?w=31&h=36';
              zIndex = 3;
              show = false;
            } else if (tournament.type === 'atp1000') {
              icon = 'http://www.atpworldtour.com/~/media/F5219431817E4ED3B773BF9B006A9ACF.ashx?w=31&h=42';
              zIndex = 4;
            } else if (tournament.type === 'atptourfinal') {
              icon = 'http://www.atpworldtour.com/~/media/47F12472FD254B08B57755E5B7565E5D.ashx?w=31&h=48';
              zIndex = 5;
            } else if (tournament.type === 'grandslam') {
              zIndex = 6;
              if (tournament.name.match(/australian open/i)) {
                icon = new google.maps.MarkerImage('images/ao_logo.png');
              } else if (tournament.name.match(/roland garros/i)) {
                icon = new google.maps.MarkerImage('images/fo_logo.png');
              } else if (tournament.name.match(/wimbledon/i)) {
                icon = new google.maps.MarkerImage('images/wo_logo.png');
              } else if (tournament.name.match(/us open/i)) {
                icon = new google.maps.MarkerImage('images/uo_logo.png');
              }
            } else if (tournament.type === 'daviscup') {
              return;
            }
          
            var label = '<div class="map-info">' +
              '<p class="tournament-name"><a href="http://www.atpworldtour.com' +
              tournament.url + '" target="_new">' + tournament.name + '</a>' +
              '</p><p><span class="tournament-time">' + tournament.start +
              '</span> @ <span class="tournament-place">' + tournament.place +
              '</span></p><p class="tournament-title-holder">Title Holder: <a href="http://www.atpworldtour.com' + 
              tournament.title_holder.url + '" target="_new">' + tournament.title_holder.name +  '</a>' +
              '</p></div>';
            var myLatLng = new google.maps.LatLng(tournament.latitude, tournament.longitude);
            var marker = new google.maps.Marker({
              position: myLatLng,
              map: show ? map : null,
              icon: icon,
              zIndex: zIndex
            });
            if (tournament.type === 'atp250') {
              atp250Markers.push(marker);
            } else if (tournament.type === 'atp500') {
              atp500Markers.push(marker);
            }
            var infoWindow = new google.maps.InfoWindow({
              content: label
            });
            google.maps.event.addListener(marker, 'click', function() {
              infoWindow.open(map, marker);
            });
          });
          
          google.maps.event.addListener(map, 'zoom_changed', function() {
            var zoom = map.getZoom();
          
            if (zoom <= 4) {
              $.each(atp250Markers, function(i, marker){ marker.setMap(null); });
            } else {
              $.each(atp250Markers, function(i, marker){ marker.setMap(map); });
            }
            if (zoom <= 3) {
              $.each(atp500Markers, function(i, marker){ marker.setMap(null); });
            } else {
              $.each(atp500Markers, function(i, marker){ marker.setMap(map); });
            }
          });
        //]]>
      </script>
    </div>
    <footer></footer>
  </body>
</html>

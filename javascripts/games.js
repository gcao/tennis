(function(){var e,t,n,r,i,s,o,u;s=["grandslam","olympics","atpfinal","atp1000","atp500","daviscup","other"],t=[],window.config={activeTypes:s.slice(0),activeOpponents:"all",allTypes:function(){return config.activeTypes.length===s.length}},r=function(e){return e.replace(/\s/g,"_")},u=function(){return $(".tournaments-by-year").show(),$("#games-chart .tournament").show(),$("#games-chart .game").hide().css("opacity",""),$(".tournament-types .toggleable").addClass("inactive"),$.each(config.activeTypes,function(){return $(".tournament-types ."+this).removeClass("inactive")}),config.allTypes()?$(".tournament-types .all.toggleable").removeClass("inactive"):($("#games-chart .tournament").hide(),$.each(config.activeTypes,function(){return $("#games-chart ."+this).show()})),$(".opponents .toggleable").addClass("inactive"),config.activeOpponents==="all"?($(".opponents .toggleable").removeClass("inactive"),$("#games-chart .game").show()):$.each(config.activeOpponents,function(){var e;return e=r(this),$(".opponents ."+e).removeClass("inactive"),$("#games-chart .tournament."+e+" .game").show().css("opacity","0.15"),$("#games-chart .tournament."+e+" .game."+e).css("opacity","")}),$("#games-chart .tournament").each(function(){return $(".game",this).filter(":visible").length>0?$(this).show():$(this).hide()}),$(".tournaments-by-year").each(function(){return $(".tournament",this).filter(":visible").length>0?$(this).show():$(this).hide()})},T.def("tournament-types",function(e){return[".tournament-types",[".toggleable.all",{click:function(){return config.allTypes()?config.activeTypes=[]:config.activeTypes=e.slice(0),u()}},"All"],T.each("tournament-type",e)]}),T.def("tournament-type",function(e){return[".toggleable.tournament-type."+e,{click:function(){return config.activeTypes.indexOf(e)>=0?config.activeTypes.splice(config.activeTypes.indexOf(e),1):config.activeTypes.push(e),u()}},o(e)]}),T.def("opponents",function(e){return[".opponents","Opponents: ",[".toggleable.all",{click:function(){return config.activeOpponents.indexOf("all")>=0?config.activeOpponents=[]:config.activeOpponents="all",u()}},"All"],T.each("opponent",e)]}),T.def("opponent",function(e){var n;return n=r(e),[".toggleable.opponent."+n,{click:function(){return config.activeOpponents==="all"?(config.activeOpponents=t.slice(0),config.activeOpponents.splice(config.activeOpponents.indexOf(e),1)):config.activeOpponents.indexOf(e)>=0?config.activeOpponents.splice(config.activeOpponents.indexOf(e),1):config.activeOpponents.push(e),u()}},e]}),T.def("games",function(){return[["h2","Games of ",["span.players"],": ",T("tournament-types",s)],T("opponents",t),[".note",{style:{"margin-top":10,color:"#777"}},"Click any player below to toggle display mode between one player and all."],["#games-chart"]]}),o=function(e){switch(e){case"grandslam":return"Grand Slam";case"olympics":return"Olympics";case"atpfinal":return"ATP Tour Finals";case"atp1000":return"ATP 1000";case"atp500":return"ATP 500";case"daviscup":return"Davis Cup";case"other":return"Other";default:return e}},T.def("tournament",function(e){var t,n;return n=e.name,e.type==="atpfinal"?n="ATP Tour Finals":e.type==="atp1000"&&(n=n.replace(/ATP World Tour Masters 1000|ATP Masters Series /,"")),[".tournament",{"class":e.type},function(){var n,i,s,o;s=e.games,o=[];for(n=0,i=s.length;n<i;n++)t=s[n],o.push({"class":r(t.opponent)});return o}(),[".tournament-info",["span.type",o(e.type)],["br"],["span.name",n]],[".games",T.each_with_index("game",e.games)]]}),T.def("game",function(e,t,n){return e.rank===0?[".game","BYE"]:[".game",{"class":r(e.opponent)},e.round==="S"?{"class":"semifinal"}:e.round==="F"||e.round==="W"?{"class":"final"}:void 0,e.result==="W"?{"class":"win"}:e.result==="L"?{"class":"lose"}:void 0,{click:function(){return config.activeOpponents.length===1&&config.activeOpponents[0]===e.opponent?config.activeOpponents="all":config.activeOpponents=[e.opponent],u()}},e.opponent," ("+e.rank+")"]}),T.def("tournaments-by-year",function(e,t){if(!t)return;return[".tournaments-by-year",[".year",e],T.each("tournament",t)]}),T.def("tournaments",function(e){var t,n,r;r=[];for(t=n="2013";n>="1998";t=--n)r.push(T("tournaments-by-year",t,e[t]));return r}),e=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;t==null&&(t=20),i={};for(c in e){u=e[c];for(p=0,v=u.length;p<v;p++){o=u[p],y=o.games;for(d=0,m=y.length;d<m;d++){n=y[d];if(n.opponent==="")continue;i[g=n.opponent]||(i[g]={name:n.opponent,matches:0,won:0}),i[n.opponent].matches+=1,n.result==="W"&&(i[n.opponent].won+=1)}}}return l=function(){var e;e=[];for(h in i)f=i[h],e.push(f);return e}(),l=l.sort(function(e,t){return t.matches-e.matches}),r=0,s=function(){var e,n,i;i=[];for(e=0,n=l.length;e<n;e++){a=l[e];if(a.matches<10&&r>=t)break;r+=1,i.push(a.name)}return i}(),s},i=function(e){return T("tournaments",e).render({inside:"#games-chart"})},n=function(n){return loadData(""+n+"_games",function(n){return t=e(n.tournaments),T("games").render({inside:".main"}),$(".players").text(n.name),i(n.tournaments)})},router.get("/games/:player",function(e){return n(e.params.player)})}).call(this);
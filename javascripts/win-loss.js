(function(){var e,t,n,r,i,s,o,u=[].slice;tmpl.winLoss=function(e,t){return[["h2","Win/loss chart of ",["span.players"],["span.note"," Click name to toggle"]],["form#win-loss-form",{action:"/win-loss",method:"get"},["input",{type:"hidden",name:"players"}],["input#grandSlam",{type:"checkbox",name:"grandSlam",value:"true",click:function(){var e;return e="#/win-loss/"+t.join(","),$(this).is(":checked")&&(e+="?grandSlam"),window.location.hash=e},postRender:function(t){if(e)return $(t).attr("checked","checked")}}],["label",{"for":"grandSlam"}," Use Grand Slam data"]],["#win-loss-chart"]]},tmpl.player=function(e,t){return["span.player"+t,{click:function(){return $("#win-loss-chart .player"+t).toggleClass("hide")}},e.name,"&nbsp;&nbsp;"]},n=function(e){var t;return t=$.map(e,function(e){return e+"_win_loss"}),loadData2(t)},i=function(e,t){var n,r,i,s;r=!0;for(i=0,s=e.length;i<s;i++){n=e[i];if(n[0]===t&&(n[1]!==0||n[2]!==0)){r=!1;break}}return r},e=function(e,t){return e?t.gs_data:t.data},o=function(e){return e?[0,100]:[0,150]},r=function(e){return e?0:50},t=function(e){return e?[0,5,10,15,20,25,30,.4,.5,.6,.7,.8,.9,1]:[0,10,20,30,40,50,60,70,80,90,100,.6,.7,.8,.9,1]},s=function(){var n,s,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,N,C,k,L,A,O,M,_,D,P;l=arguments[0],S=2<=arguments.length?u.call(arguments,1):[],S=normalizeResults(S),T.eachWithIndex(tmpl.player,S).render({inside:".players"}),y={top:30,right:20,bottom:30,left:40},N=960-y.left-y.right,p=550-y.top-y.bottom,O=[2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013],C=d3.scale.ordinal().rangeRoundBands([0,N],.1).domain(O),A=d3.scale.linear().rangeRound([p,0]).domain(o(l)),L=d3.svg.axis().scale(C).orient("bottom"),x=d3.select("#win-loss-chart").html("").append("svg").attr("width",N+y.left+y.right).attr("height",p+y.top+y.bottom).append("g").attr("transform","translate("+y.left+","+y.top+")"),x.append("g").attr("class","x axis").attr("transform","translate(0, "+p+")").call(L),c=x.selectAll(".h-grid").data(t(l)).enter().append("g").attr("class","h-grid"),h=function(e){var t;return t=l?e>1?e:e*100:e===0||e>1?e:50+e*100,A(t)},c.append("line").attr("x1",function(e,t){return 0}).attr("y1",h).attr("x2",function(e,t){return N}).attr("y2",h),c.append("text").text(function(e,t){return 0<e&&e<=1?d3.format("%d")(e):e}).attr("x",function(e,t){return-5}).attr("y",h).attr("text-anchor","end"),P=[];for(w=_=0,D=S.length;_<D;w=++_)E=S[w],f=e(l,E),O=function(){var e,t,n;n=[];for(e=0,t=f.length;e<t;e++)a=f[e],n.push(a[0]);return n}(),b=x.selectAll(".player"+w).data(f).enter().append("g").attr("class","player player"+w).attr("transform",function(e){return"translate("+C(e[0])+", 0)"}),k=d3.scale.ordinal().domain(function(){var e,t,n;n=[];for(d=e=0,t=S.length;e<t;d=++e)M=S[d],n.push(d);return n}()).rangeRoundBands([0,C.rangeBand()],.05),s=function(e,t){var n;return S.length===1?21:(n=w,w===0&&S.length>1?i(S[1].data,e[0])&&(n=1):w===3&&i(S[2].data,e[0])&&(n=2),k(n))},n=S.length===1?Math.min(C.rangeBand(),30):k.rangeBand(),b.selectAll(".win").data(function(e){return[e]}).enter().append("rect").attr("class","win").attr("x",s).attr("width",n).attr("y",function(e){return A(0)}).attr("height",function(e){return 0}).transition().delay(function(e,t){return t*300}).duration(1e3).attr("y",function(e){return A(e[1])}).attr("height",function(e){return A(0)-A(e[1])}),b.selectAll(".loss").data(function(e){return[e]}).enter().append("rect").attr("class","loss").attr("x",s).attr("width",n).attr("y",function(e){return $(this).parent().find(".win").attr("y")}).attr("height",function(e){return 0}).transition().delay(function(e,t){return t*300}).duration(1e3).attr("y",function(e){return A(e[1]+e[2])}).attr("height",function(e){var t;return t=A(e[1])-A(e[1]+e[2]),t>0?t-1:t}),b.selectAll(".percentage").data(function(e){return[e]}).enter().append("circle").attr("class","percentage").attr("r",function(e){return e[1]===0&&e[2]===0?0:3}).attr("cx",function(e,t){return 35}).attr("cy",function(e){return e[1]===0&&e[2]===0?0:A(r(l)+100*e[1]/(e[1]+e[2]))}),S.length===1&&b.append("text").text(function(e){return e[1]===0&&e[2]===0?"":d3.format("%d")(e[1]/(e[1]+e[2]))}).attr("x",function(e,t){return 20}).attr("y",function(e){return e[1]===0&&e[2]===0?0:A(r(l)+100*e[1]/(e[1]+e[2]))-10}),v=d3.svg.line().x(function(e){return C(e[0])+35}).y(function(e){return A(r(l)+100*e[1]/(e[1]+e[2]))}),g=function(){var e,t,n;n=[];for(e=0,t=f.length;e<t;e++)a=f[e],(a[1]!==0||a[2]!==0)&&n.push(a);return n}(),P.push(m=x.selectAll(".line.player"+w).data([g]).enter().append("g").attr("class","line player"+w).append("path").attr("d",v));return P},router.get("/win-loss/:players",function(e){var t,r;return r=e.params.players.split(","),t=e.params.grandSlam,T(tmpl.winLoss,t,r).render({inside:".main"}),n(r).then(function(){var e;return e=1<=arguments.length?u.call(arguments,0):[],s.apply(null,[t].concat(u.call(e)))})})}).call(this);
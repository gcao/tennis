(function(){var e,t;tmpl.schedule=function(){return[["h2",["span#player_name"],"'s tournament schedule"],["#map"],["#schedule"]]},e=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_;l=new google.maps.LatLngBounds,x=t.getPosition(),T=n.getPosition(),l.extend(x),l.extend(T),d=new Array,o=Math.PI,k=Math.sin,u=Math.asin,c=Math.cos,a=Math.atan2,C=Math.pow,L=Math.sqrt,v=x.lat()*(o/180),y=x.lng()*(o/180),m=T.lat()*(o/180),b=T.lng()*(o/180),h=2*u(L(C(k((v-m)/2),2)+c(v)*c(m)*C(k((y-b)/2),2))),f=a(k(y-b)*c(m),c(v)*k(m)-k(v)*c(m)*c(y-b))/-(o/180),f=f<0?360+f:f,E=0;while(E<51)p=.02*E,p=p.toFixed(6),i=k((1-p)*h)/k(h),s=k(p*h)/k(h),O=i*c(v)*c(y)+s*c(m)*c(b),M=i*c(v)*k(y)+s*c(m)*k(b),_=i*k(v)+s*k(m),g=a(_,L(C(O,2)+C(M,2))),w=a(M,O),S=new google.maps.LatLng(g/(o/180),w/(o/180)),d.push(S),E++;return A=function(){switch(r){case"past":return"#888";case"present":return"#f44";default:return"#FF9601"}}(),N=new google.maps.Polyline({map:e,path:d,strokeColor:A,strokeWeight:3,strokeOpacity:1})},window.filterTournaments=function(e,t){return $.map(t,function(t){var n,r;return n=e.filter(function(e){return e.name===t.tournament}),n.length>0?(r=n[0],r.result=t.result,r.defeated=t.defeated,r.lost_to=t.lost_to,r):typeof console!="undefined"&&console!==null?console.log("Tournament not found: "+t.tournament):void 0})},window.drawMapWithSchedule=function(t){var n,r,i,s,o,u,a,f,l,c,h,p,d;window.map=getMap(),f=void 0,a=void 0,d=[];for(n=h=0,p=t.length;h<p;n=++h){l=t[n];if(l.type==="daviscup")continue;r=getTournamentLogo(l.type,l.name),c=getTournamentPriority(l.type),u=new google.maps.LatLng(l.latitude,l.longitude),s=new google.maps.Marker({position:u,map:map,icon:r,zIndex:c}),i=new google.maps.InfoWindow({content:T("tournament-info-window",l).toString()}),google.maps.event.addListener(s,"click",function(){return i.open(map,s)}),f&&(o=isFuture(f.start)?"future":isFuture(l.start)?"present":"past",e(map,a,s,o)),f=l,d.push(a=s)}return d},t=function(e){switch(e){case"W":return"won";case"F":return"final";case"SF":return"semi-final";case"QF":return"quarter-final";case"1/16":return"round-of-16";case"1/32":return"round-of-32";case"1/64":return"round-of-64";case"1/128":return"round-of-128";default:return""}},tmpl.tournamentResult=function(e){if(!e.result)return;return["div.detail",["table",["tr",["td","Result"],["td",e.result]],e.defeated?["tr",["td","Defeated"],["td",e.defeated]]:void 0,e.lost_to?["tr",["td","Lost to"],["td",e.lost_to]]:void 0]]},tmpl.tournament=function(e){var n,r,i,s;return s=getAtpUrl(e.url),i=getTournamentLogo(e.type,e.name),r=isFuture(e.start)?"future":"",n=t(e.result),["div.tournament",{"class":""+r+" "+n},["div.start",e.start],["div.logo",["a",{href:s,target:"_new"},["img",{src:i}]]],["div.name",["a",{href:s,target:"_new"},e.name],"&nbsp;&nbsp;",T(tmpl.buyTicketLink,e,getTicketUrl(e.name))],T(tmpl.tournamentResult,e)]},window.setMapCenterToTournament=function(e){return map.setCenter(new google.maps.LatLng(e.latitude,e.longitude))},router.get("/schedule/:player",function(e){var t;return console.log("schedule"),T(tmpl.schedule).render({inside:".main"}),t=e.params.player,t?$.when(loadData("tournaments"),loadData(t+"_schedule")).then(function(e,t){var n,r;return r=e[0],n=t[0],$("#player_name").text(n.name),n=$.map(n.data,function(e){return typeof e=="string"?{tournament:e}:e}),r=filterTournaments(r.data,n),drawMapWithSchedule(r),T.each(tmpl.tournament,r).render({inside:"#schedule"})}):($("#map, #schedule").hide(),$(".main h2").html('No player is selected. Please select players from "Schedules" menu'))})}).call(this);
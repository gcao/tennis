#map
%p Please zoom in to see ATP500 and ATP250 tournaments.

%script(type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true")
%script(src='data/tournaments.js')
:javascript
  var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 3,
    center: new google.maps.LatLng(20, 0),
    mapTypeId: google.maps.MapTypeId.TERRAIN
  });
  var atp500Markers = [];
  var atp250Markers = [];
  $.each(tournaments.data, function(i, tournament){
    var icon = '';
    var zIndex = 1;
    var show = true;
    if (tournament.type === 'atp250') {
      icon = 'http://www.atpworldtour.com/~/media/810218DC73784BEEA6EF0978B2842A69.ashx?w=31&h=36';
      zIndex = 2;
      show = false;
    } else if (tournament.type === 'atp500') {
      icon = 'http://www.atpworldtour.com/~/media/1DB04CA8505648B7B511FA1E37F1E3BA.ashx?w=31&h=36';
      zIndex = 3;
      show = false;
    } else if (tournament.type === 'atp1000') {
      icon = 'http://www.atpworldtour.com/~/media/F5219431817E4ED3B773BF9B006A9ACF.ashx?w=31&h=42';
      zIndex = 4;
    } else if (tournament.type === 'atptourfinal') {
      icon = 'http://www.atpworldtour.com/~/media/47F12472FD254B08B57755E5B7565E5D.ashx?w=31&h=48';
      zIndex = 5;
    } else if (tournament.type === 'grandslam') {
      zIndex = 6;
      if (tournament.name.match(/australian open/i)) {
        icon = new google.maps.MarkerImage('images/ao_logo.png');
      } else if (tournament.name.match(/roland garros/i)) {
        icon = new google.maps.MarkerImage('images/fo_logo.png');
      } else if (tournament.name.match(/wimbledon/i)) {
        icon = new google.maps.MarkerImage('images/wo_logo.png');
      } else if (tournament.name.match(/us open/i)) {
        icon = new google.maps.MarkerImage('images/uo_logo.png');
      }
    } else if (tournament.type === 'daviscup') {
      return;
    }

    var label = '<div class="map-info">' +
      '<p class="tournament-name"><a href="http://www.atpworldtour.com' +
      tournament.url + '" target="_new">' + tournament.name + '</a>' +
      '</p><p><span class="tournament-time">' + tournament.start +
      '</span> @ <span class="tournament-place">' + tournament.place +
      '</span></p><p class="tournament-title-holder">Title Holder: <a href="http://www.atpworldtour.com' + 
      tournament.title_holder.url + '" target="_new">' + tournament.title_holder.name +  '</a>' +
      '</p></div>';
    var myLatLng = new google.maps.LatLng(tournament.latitude, tournament.longitude);
    var marker = new google.maps.Marker({
      position: myLatLng,
      map: show ? map : null,
      icon: icon,
      zIndex: zIndex
    });
    if (tournament.type === 'atp250') {
      atp250Markers.push(marker);
    } else if (tournament.type === 'atp500') {
      atp500Markers.push(marker);
    }
    var infoWindow = new google.maps.InfoWindow({
      content: label
    });
    google.maps.event.addListener(marker, 'click', function() {
      infoWindow.open(map, marker);
    });
  });

  google.maps.event.addListener(map, 'zoom_changed', function() {
    var zoom = map.getZoom();

    if (zoom <= 4) {
      $.each(atp250Markers, function(i, marker){ marker.setMap(null); });
    } else {
      $.each(atp250Markers, function(i, marker){ marker.setMap(map); });
    }
    if (zoom <= 3) {
      $.each(atp500Markers, function(i, marker){ marker.setMap(null); });
    } else {
      $.each(atp500Markers, function(i, marker){ marker.setMap(map); });
    }
  });
